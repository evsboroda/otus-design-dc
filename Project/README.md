## Разработка и проектирование миграции 3-tier сети ЦОД предприятия на сеть leaf-spine с внедрением архитектуры VXLAN/EVPN

### Цель:
- Споектировать сеть Leaf-spine (Clos)
- Разработать план мигарции существующего ЦОД на архитектуру Leaf-spine c технологией VXLAN/EVPN
- Обеспечить L2 связанность для возможности миграции ВМ посредтсвом VMWare Vmotion
- Обспечить L3 связонность для с сетью территории, обьектами предприятия и внутри фабрики.

### Текущая архитектура
ЛВС предприятия располагается в двух ЦОД построеных по архитектуре 3-tier и размещенных в зданиях предприятия - площадка  DC1 и площадка DC2. Обе площадки идентичны по составу для обеспечения отказоустойчивости в случае полного или частичного отказа одной из площадок.

В ЦОД распологаются сервера обеспечивающие работоспособность корпаративных сервисов, а так же сервера систем безопасности территории предприятия и инженерных систем. 

На территории предприятия построена кольцевая сеть безопасности и инженерных систем. Сеть подключена с двух сторон в каждый ЦОД.

Также на территории размещаются капитальные строения в которых присутсвует своя внутренняя ЛВС, а для обеспечения связи с ЦОД они подключены по одному каналу в каждый ЦОД и настроен eBGP.
### Схема текущей сети
> схема упрощена

![alt text](DC_3-tier.jpg)

В настоящий момент планируется перенос обоих ЦОД с существующих площадок на другую площадку предприятия и последующего их обьединения.

### Состав оборудования ЦОД
Вся сеть предприятия построена на оборудовании HPE, но так как в EVE-NG существует только один образ для их оборудования "h3cvsr2k" для возможности реализации L2 функций буду использовать образ Arista.

Все коммутаторы ядра и аггрегации и доступа собраны в IRF фабрику. При миграции планируется отказ от стеков, что бы получить удобство в обслуживании и отказоустойчивость на уровне управления.

|коммутатор|модель|текущая роль|планируемая|кол-во|
|----------|------|------------|-----------|------|
|DC1-2-core|HPE FlexFabric 7900|ядро|Spine| 4 |
|DC1-2-AGG|HPE FlexFabric 5900|аггрегация|Leaf|4|
|на схеме не указан| HPE FlexFabric 5900| доступ|bleaf/bgw|4|

Разобрав все IRF фабрики (стеки) мы получим достаточное колличество оборудования для построения сети ЦОД по архитектуре Leaf-spine.\
 Всё оборудование поддерживает технологии VXLAN/EVP

### План миграции


### Именование оборрудования
|роль площадки|название площадки|роль оборудования|номер|
|----|---|---|---|
|DC|LZ|SP|1|

**DC** - Data center\
**SP** - Spine\
**LF** - Leaf\
**BLF** - Border leaf\
**RTR** - Router\
**AGG** - Aggregation\
**CR** - Core 

### Адресное пространство сетевого оборудования

#### Loopback адреса

| **Device** | **Loopback1** | **Loopback2** | 
| --- | --- | --- |
| **DC-L-SP.1** | 10.0.1.1/32 | 10.0.1.2/32 |
| **DC-L-SP.2** | 10.0.2.1/32 | 10.0.2.2/32 | 
| **DC-L-LF.1** | 10.1.1.1/32 | 10.1.1.2/32 | 
| **DC-L-LF.2** | 10.1.2.1/32 | 10.1.2.2/32 | 
| **DC-L-BLF.1** | 10.3.1.1/32 | 10.3.1.2/32 | 
|**DC-L-BLF.2**|10.3.2.1/32| 10.3.2.2/32|

#### Адреса для p2p линков

| **Device** | **DC-L-LF.1** | **DC-L-LF.2** | **DC-L-BLF.1** | **DC-L-BLF.2**|
| --- | --- | --- | --- |---|
| **DC-L-SP.1** | 10.2.1.0/31 | 10.2.1.2/31 | 10.2.1.4/31 | 10.2.1.6/31|
| **DC-L-SP.2** | 10.2.2.0/31 | 10.2.2.2/31 | 10.2.2.4/31 | 10.2.2.6/31|

#### адреса p2p на интерфейсах

| **Device** | **Порт** | **название** | **Адрес** | **Маска** |
| --- | --- | --- | --- | --- |
| **DC-L-SP.1** | Et1 | DC-L-LF.1 | 10.2.1.0 | 255.255.255.254 |
|     | Et2 | DC-L-LF.2 | 10.2.1.2 | 255.255.255.254 |
|     | Et5 | DC-L-BLF.1 | 10.2.1.4 | 255.255.255.254 |
|     | Et6 | DC-L-BLF.2 | 10.2.1.6 | 255.255.255.254 |
| **DC-L-SP.2** | Et1 | DCN-LF.1 | 10.2.2.0 | 255.255.255.254 |
|     | Et2 | DC-L-LF.2 | 10.2.2.2 | 255.255.255.254 |
|     | Et5 | DC-L-BLF.1 | 10.2.2.4 | 255.255.255.254 |
|     | Et6 | DC-L-BLF.2 | 10.2.2.6 | 255.255.255.254 |
| **DC-L-LF.1** | Et1 | DC-L-SP.1 | 10.2.1.1 | 255.255.255.254 |
|     | Et2 | DC-L-SP.2 | 10.2.2.1 | 255.255.255.254 |
| **DC-L-LF.2** | Et1 | DC-L-SP.1 | 10.2.1.3 | 255.255.255.254 |
|     | Et2 | DC-L-SP.2 | 10.2.2.3 | 255.255.255.254 |
| **DC-L-BLF.1** | Et1 | DC-L-SP.1 | 10.2.1.5 | 255.255.255.254 |
|     | Et2 | DC-L-SP.2 | 10.2.2.5 | 255.255.255.254 |
| **DC-L-BLF.2**| Et1 | DC-L-SP.1 | 10.2.1.7 | 255.255.255.254 |
|     | Et2 | DC-L-SP.2 | 10.2.2.7 | 255.255.255.254 |

#### адреса peer-link для MC-LAG

| **Device** | **Порт** | **название** | **Адрес** | **Маска** |
| --- | --- | --- | --- | --- |
| **DC-LZ-LF.1** | Et9 | DC-LZ-LF.2_mlag_peer-link | 10.4.0.0 | 255.255.255.254 |
| **DC-LZ-LF.2** | Et9 | DC-LZ-LF.1_mlag_peer-link | 10.4.0.1 | 255.255.255.254 |

### Адресное пространство сервисов 

|Назначение|Vlan| Network| VRF |
|----|----|----|----|
|SRV-1|vlan 10|10.182.10.0/24| VRF_SRV|
|SRV-2|vlan 20|10.182.20.0/24| VRF_SRV|
|VMWare MGMT| vlan 1000|10.82.60.0/24| VRF_VMMGMT|

### Номера автономных систем.

|Площадка|ASN format|AS|
|----|----|----|
|DC-LZ| 4-Byte| 65000:65001|
|DC-1| 2-byte| 65535|
|obj1| 2-byte| 65001|
|obj2| 2-byte| 65002|
